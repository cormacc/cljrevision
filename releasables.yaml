:releasables:
  - :id: revision
    :revision:
      :src: src/rel/version.cljc
      :regex: (?<prefix>\(def current ")(?<major>\d+)(?<sep1>\.)(?<minor>\d+)(?<sep2>\.)(?<patch>[\w\d]+)(?<postfix>"\))
      :comment_prefix: ";;"
    # Quoting isn't necessary for string build steps, however it is for those including special characters
    # like $
    :build_steps:
      - "export BUILD_TIME=$(date)"
      - "echo Build started at: $BUILD_TIME"
      - "echo Current user: $USER"
      - "bb test:bb"
      - "echo Build completed successfully at $(date)"
      - bb test:bb
    #Define 3 build artefacts as test cases for 'deploy' and 'archive' tasks
    #Expect checksum file to be generated by default for first entry (where not specified explicitly)
    :artefacts:
      - :src: rel
        :dest: rel-v<REV>
      - :src: CLAUDE.md
        :chk: false
      - :src: bb.edn
        :chk: true
    #Define two deployment destinations to verify multiple deployments work as intended
    :archive: ./build/archives
    :deploy:
      - :dest: ./build/deploy-dest/1
      - :dest: ./build/deploy-dest/2
      # And check if the new (v2.0.2) deployment steps work....
      - :steps:
        - "export DEPLOYED_AT=$(date)"
        - mkdir -p ./build/deploy-dest/3
        - touch ./build/deploy-dest/3/deployed.txt
        - "echo \"Custom deployment completed at $DEPLOYED_AT\" > ./build/deploy-dest/3/deployed.txt"
